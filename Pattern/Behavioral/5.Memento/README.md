# 5. Memento (Помни/Снимок)
__Суть:__
Позволяет сохранять и восстанавливать предыдущее состояние объекта без раскрытия его внутренней структуры.

Шаблон проектирования «__Помни/Снимок__» — это поведенческий шаблон проектирования, который предоставляет механизм для сохранения внутреннего состояния объекта и последующего восстановления этого состояния. Этот шаблон полезен, когда нам нужно реализовать такие функции, как отмена/повтор или когда мы хотим сохранить и восстановить состояние объекта по разным причинам.
## Задача
>_Предположим, нам нужно представить два состояния с помощью паттерна «Помни». Тогда мы можем использовать три класса для представления этого паттерна: класс Originator для хранения данных, паттерн «Помни» для хранения состояния Originator, а также класс Caretaker, который будет хранить «Помни» для решения проблемы._
## Ключевые компоненты паттерна Снимок
* __Исходный код:__ Это объект, состояние которого мы хотим зафиксировать. Исходный код создаёт объект Memento для сохранения своего состояния и использует его для восстановления своего состояния.
* __Memento:__ Это объект, который хранит состояние Originator. У него есть два основных интерфейса: getState() возвращает сохранённое состояние и setState(state) устанавливает состояние в определённое значение.
* __Хранитель:__ Отвечает за хранение объектов Memento и управление ими. Он не изменяет Memento, но может сохранять и восстанавливать состояние создателя.

## Диаграмма паттерна Снимок
<figure>
    <img src ="/assets/images/Diagram_Memento.jpg" alt = "Memento">
</figure>

## Пример
```c++
#include <iostream>
#include <string>

// Объект, состояние которого нужно сохранять
class Editor {
    std::string text;
public:
    void setText(const std::string& s) { text = s; }
    std::string getText() const { return text; }

    // Создает снимок текущего состояния
    class Memento {
        std::string state;
        friend class Editor;
        Memento(const std::string& s) : state(s) {}
    public:
        std::string getState() const { return state; }
    };

    Memento createMemento() const { return Memento(text); }
    void restoreFromMemento(const Memento& m) { text = m.getState(); }
};

// Опекун (Caretaker) управляет снимками
class History {
    std::vector<Editor::Memento> mementos;
public:
    void push(const Editor::Memento& m) { mementos.push_back(m); }
    Editor::Memento pop() {
        if (mementos.empty()) throw std::runtime_error("No mementos");
        auto m = mementos.back();
        mementos.pop_back();
        return m;
    }
};

int main() {
    Editor editor;
    History history;

    editor.setText("Version 1");
    history.push(editor.createMemento());

    editor.setText("Version 2");
    std::cout << "Current: " << editor.getText() << std::endl;  // Version 2

    editor.restoreFromMemento(history.pop());
    std::cout << "Restored: " << editor.getText() << std::endl;  // Version 1

    return 0;
}
```

## Преимущества шаблона проектирования Memento:
✅ __Простое управление состоянием:__ Управление историей состояний объекта становится проще благодаря шаблону Memento. Он позволяет сохранять и восстанавливать состояние объекта в разные моменты времени, не загромождая интерфейс или код объекта.

✅ __Инкапсуляция состояния объекта:__ Шаблон проектирования «Помни» инкапсулирует состояние объекта в отдельном объекте «Помни». Это гарантирует, что состояние объекта не будет напрямую доступно внешним классам, что соответствует принципу инкапсуляции и сокрытия информации.

✅ __Поддержка отмены и повтора действий:__ Шаблон проектирования «Помни» широко используется для реализации функций отмены и повтора действий в приложениях. Сохраняя историю состояний объекта и управляя ею, мы можем легко вернуть объект в предыдущее состояние или перейти к более позднему состоянию, обеспечивая удобство для пользователя.

✅ __Снимок состояния и откат:__ Этот шаблон позволяет делать снимки состояния объекта в определённые моменты, что может быть полезно для отладки и анализа. Мы также можем откатить объект до предыдущего состояния, чтобы устранить неполадки или изучить проблемы.

✅ __Гибкость:__ Шаблон является гибким и может быть адаптирован к различным сценариям использования. Мы можем реализовать его с разной степенью детализации: от сохранения всего состояния объекта до сохранения только его отдельных частей.

✅ __Поддерживает целостность объекта:__ Благодаря инкапсуляции логики управления состоянием в Memento шаблон Memento помогает поддерживать целостность объекта. Он предотвращает случайное изменение состояния объекта вне предусмотренных механизмов.

✅ __Расширяемость:__ Мы можем расширить шаблон Memento, чтобы реализовать дополнительные функции. Например, мы можем добавить такие функции, как контроль версий, ветвление или обмен состояниями объектов с другими объектами или пользователями.

✅ __Улучшенное тестирование и отладка:__ Благодаря возможности фиксировать и восстанавливать состояния объектов шаблон Memento может помочь в тестировании и отладке, позволяя изолировать определённые состояния для тестирования или анализа.

## Недостатки шаблона проектирования Memento:
❌ __Увеличение потребления памяти:__ для сохранения состояния объекта требуется дополнительная память. Это может стать проблемой, если мы работаем с большими объектами или большим количеством объектов, так как это может привести к увеличению потребления памяти.

❌ __Накладные расходы на производительность:__ процесс создания и восстановления состояний может привести к некоторым накладным расходам на производительность. Это особенно актуально, если состояние сложное или часто меняется, поскольку системе приходится управлять несколькими состояниями и хранить их.

❌ __Нарушение инкапсуляции:__ Чтобы зафиксировать и восстановить внутреннее состояние объекта, шаблон проектирования «Помни» может потребовать раскрытия внутренних деталей объекта. Это может нарушить принципы инкапсуляции, сделав детали реализации объекта доступными для внешних классов.

❌ __Управление версиями и совместимость:__ Если внутренняя структура объекта меняется, шаблон Memento может столкнуться с проблемами, связанными с управлением версиями и совместимостью. Это может стать проблемой при попытке восстановить состояние объекта, сохраненное с помощью более старой версии Memento.

❌ __Сложность реализации:__ Реализация шаблона проектирования «Помни» может привести к усложнению кодовой базы. Управление созданием, хранением и извлечением мемов может быть непростой задачей, особенно в крупных системах.

❌ __Управление хранилищем:__ Управление хранилищем, в котором хранятся различные памятные вещи, может оказаться непростой задачей, особенно если необходимо ограничить количество сохраняемых состояний или если ресурсы хранилища ограничены.

❌ __Зависимость от источника:__ шаблон Memento создаёт зависимость между источником (объектом, состоянием которого управляют) и memento (объектом, представляющим состояние). Изменения в источнике могут потребовать соответствующих изменений в memento, и эта тесная связь может повлиять на гибкость системы.

## Где применяется?
1. Текстовые редакторы (Ctrl+Z).
2. Игры (сохранение позиции игрока).
3. Транзакции в БД.