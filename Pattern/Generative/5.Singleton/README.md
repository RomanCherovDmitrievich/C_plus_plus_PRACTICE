# 5. Одиночка (Singleton)
__Суть:__
Гарантирует, что у класса есть только один экземпляр.

Шаблон __Singleton__ — это шаблон проектирования в C++, который гарантирует, что у класса будет только один экземпляр, и предоставляет глобальную точку доступа к этому экземпляру. Он используется, когда нужно контролировать создание экземпляров класса, чтобы на протяжении всего времени работы приложения существовал только один экземпляр.
## Ключевые компоненты паттерна Одиночка
* __Класс-одиночка:__ это класс, который вы хотите сделать одноэлементным. У него есть закрытый конструктор, закрытый деструктор и закрытая статическая переменная-член для хранения единственного экземпляра класса.
* __Статическая переменная-член:__ это закрытая статическая переменная-член в классе Singleton, которая содержит единственный экземпляр класса. Обычно она инициализируется значением nullptr или экземпляром самого класса.
* __Статический метод (getInstance):__ общедоступный статический метод в классе Singleton с именем getInstance. Этот метод отвечает за создание экземпляра, если он не существует, или за возврат существующего экземпляра. Он гарантирует, что существует только один экземпляр класса.
* __Удалить конструктор копирования и оператор присваивания:__ Чтобы предотвратить копирование экземпляра Singleton, в классе Singleton следует удалить конструктор копирования и оператор присваивания.

## Диаграмма паттерна Одиночка
<figure>
    <img src ="/assets/images/Diagram_Singleton.png" alt = "Singleton">
</figure>

## Пример
```c++
class Logger {
public:
    static Logger& getInstance() {
        static Logger instance;
        return instance;
    }
    void log(const std::string& msg) { std::cout << msg << "\n"; }

private:
    Logger() {} // Приватный конструктор
    Logger(const Logger&) = delete;
    Logger& operator=(const Logger&) = delete;
};
```
## Преимущества шаблона проектирования Одиночка
✅ Контролируемый доступ к единственному экземпляру.

✅ __Одиночный экземпляр:__ Основное преимущество шаблона проектирования «Одиночка» заключается в том, что он гарантирует наличие только одного экземпляра класса во всём приложении. Это особенно полезно, когда нужно контролировать доступ к ресурсу или обеспечить единую точку управления для определённой функции.

✅ __Глобальный доступ:__ Экземпляр Singleton доступен во всём приложении. Это позволяет разным частям вашего кода получать доступ к одному и тому же экземпляру и управлять им, что удобно для обмена данными или функциональными возможностями.

✅ __Отложенная инициализация:__ в шаблоне проектирования «Одиночка» часто используется отложенная инициализация, то есть экземпляр создаётся только тогда, когда он впервые понадобился. Это может сократить время запуска приложения и повысить эффективность использования памяти, поскольку ресурсы выделяются только при необходимости.

✅ __Управление ресурсами:__ Синглтоны можно использовать для управления общими ресурсами, такими как подключения к базе данных, пулы потоков, параметры конфигурации или механизмы кэширования. Контролируя доступ к этим ресурсам с помощью синглтона, вы можете обеспечить эффективное распределение и освобождение ресурсов.

✅ __Снижение потребления памяти:__ поскольку существует только один экземпляр класса Singleton, это позволяет снизить потребление памяти по сравнению с созданием нескольких экземпляров одного и того же класса.
Избегает использования глобальных переменных: Синглтон обеспечивает контролируемый доступ к глобальным переменным, не прибегая к их использованию, что может привести к ошибкам и затруднить управление.

✅ __Поточная безопасность:__ паттерн «Одиночка» может быть реализован для обеспечения потокобезопасности, гарантирующей безопасный доступ к единственному экземпляру в многопоточных средах.

✅ __Упрощённое тестирование:__ во время модульного тестирования экземпляры синглтонов можно легко заменить фиктивными объектами или тестовыми двойниками, что упрощает изоляцию и тестирование конкретных частей кода.
✅ __Согласованное состояние:__ поскольку существует только один экземпляр, это гарантирует, что состояние синглтона будет согласованным на протяжении всего жизненного цикла приложения.

✅ __Улучшенная организация кода:__ Синглтон помогает организовать код, предоставляя чёткую точку доступа к определённой функции или ресурсу. Он обеспечивает структурированный способ взаимодействия с этой функцией, что делает кодовую базу более удобной для поддержки.

✅ __Управление инициализацией:__ Синглтон позволяет контролировать, когда и как инициализируется экземпляр, что даёт возможность выполнить любую необходимую настройку или конфигурацию перед использованием экземпляра.

## Недостатки шаблона проектирования Одиночка
❌ Усложняет тестирование.
❌ Нарушает принцип единственной ответственности.

❌ __Глобальное состояние:__ один из основных недостатков шаблона проектирования «Одиночка» заключается в том, что он вводит в ваше приложение форму глобального состояния. Это означает, что экземпляр «Одиночки» доступен из любой точки кода, что может привести к появлению скрытых зависимостей и затруднить отслеживание и анализ потока данных.

❌ __Тесная связь:__ шаблон проектирования «Одиночка» может привести к тесной связи между различными частями вашей кодовой базы, поскольку многие части приложения могут зависеть от экземпляра «Одиночки». Это может затруднить изменение или замену класса «Одиночка» без влияния на другие компоненты.

❌ __Проблемы тестирования:__ Тестирование классов-одиночек может быть более сложным. Поскольку экземпляр класса-одиночки доступен глобально, может быть затруднительно изолировать и тестировать отдельные компоненты. Модульные тесты могут зависеть от состояния класса-одиночки, что делает их менее предсказуемыми.

❌ __Ограниченное наследование:__ Наследование от класса-одиночки может быть проблематичным. Если вы хотите создать подкласс от класса-одиночки, это может не сработать, поскольку шаблон проектирования «Одиночка» предусматривает наличие только одного экземпляра базового класса. Наследование может привести к неожиданному поведению или нарушить принцип наличия только одного экземпляра.

❌ __Сложно имитировать:__ при тестировании может быть сложно имитировать или заменить экземпляр Singleton тестовым двойником. Шаблон Singleton жестко привязывает ваш код к конкретному экземпляру, что делает его менее гибким для тестирования.

❌ __Проблемы параллелизма:__ при неправильной реализации синглтоны могут вызывать проблемы параллелизма в многопоточных приложениях. Для обеспечения безопасного доступа к экземпляру синглтона может потребоваться использование механизмов синхронизации, таких как блокировки или мьютексы, что может усложнить ваш код.

❌ __Чрезмерное использование шаблона Singleton:__ Из-за его удобства разработчики могут злоупотреблять шаблоном Singleton, что приводит к избыточному количеству экземпляров Singleton в приложении. Это может свести на нет цель использования шаблона и привести к увеличению потребления памяти.

❌ __Издержки инициализации:__ Отложенная инициализация, несмотря на все преимущества, может привести к дополнительным издержкам при первом обращении к экземпляру Singleton. Если процесс инициализации требует больших ресурсов, это может повлиять на время запуска приложения.

❌ __Трудности отладки:__ Отладка кодовой базы на основе синглтона может быть непростой задачей, особенно при возникновении проблем, связанных с состоянием синглтона. Может быть сложно отследить источник проблем, если несколько частей кода могли изменить данные синглтона.

❌ __Ограниченное внедрение зависимостей:__ Использование внедрения зависимостей и инверсии управления становится менее простым, если полагаться на экземпляры Singleton. Внедрение альтернативных реализаций или конфигураций может быть затруднено, поскольку доступ к экземпляру Singleton обычно осуществляется глобально.

## Когда применять?
1. Когда нужен ровно один экземпляр класса (настройки, логгеры).
2. При работе с подключениями к базе данных эффективно использовать пул подключений, которые можно использовать повторно (пул подключений к базе данных)
3. В приложениях, использующих ограниченные ресурсы, такие как лицензии или токены, диспетчер ресурсов Singleton может контролировать выделение и освобождение этих ресурсов (диспетчер ресурсов)